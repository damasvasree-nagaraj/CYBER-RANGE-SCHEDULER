<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber Range Scheduler</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #1a1a2e; color: #eee; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { color: #00d4ff; margin-bottom: 30px; text-align: center; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .card { background: #16213e; border: 2px solid #00d4ff; border-radius: 8px; padding: 20px; }
        .card h2 { color: #00d4ff; margin-bottom: 15px; font-size: 16px; }
        .lab-item { background: #0f3460; padding: 12px; margin: 8px 0; border-radius: 4px; border-left: 4px solid #00d4ff; }
        .lab-name { font-weight: bold; }
        .lab-zone { display: inline-block; padding: 2px 8px; border-radius: 3px; font-size: 12px; margin-left: 10px; }
        .zone-red { background: #e74c3c; color: white; }
        .zone-yellow { background: #f39c12; color: white; }
        .zone-green { background: #27ae60; color: white; }
        .booking-item { background: #0f3460; padding: 12px; margin: 8px 0; border-radius: 4px; border-left: 4px solid #2ecc71; }
        .booking-team { font-weight: bold; }
        .booking-time { font-size: 12px; color: #bbb; margin-top: 5px; }
        .status { display: inline-block; padding: 2px 6px; border-radius: 2px; font-size: 11px; margin-left: 10px; }
        .status-scheduled { background: #3498db; color: white; }
        .status-active { background: #2ecc71; color: white; }
        .status-maintenance { background: #e67e22; color: white; }
        .button { background: #00d4ff; color: black; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 10px 5px 10px 0; font-weight: bold; }
        .button:hover { background: #00a8cc; }
        .input-section { background: #16213e; border: 2px solid #00d4ff; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        input, select { background: #0f3460; color: #eee; border: 1px solid #00d4ff; padding: 8px; border-radius: 4px; margin: 5px 0; width: 100%; }
        .loading { text-align: center; color: #00d4ff; }
        .error { background: #e74c3c; padding: 10px; border-radius: 4px; margin: 10px 0; color: white; }
    </style>
    
</head>
<body>
    <div class="container">
        <h1>üîê Cyber Range Scheduler</h1>
        
        <!-- Create Lab Section -->
        <div class="input-section">
            <h2>‚ûï Create New Lab</h2>
            <input type="text" id="labName" placeholder="Lab Name (e.g., Red Lab 2)">
            <input type="text" id="labDesc" placeholder="Description">
            <select id="labZone">
                <option value="">Select Zone</option>
                <option value="RED">RED (Offensive)</option>
                <option value="YELLOW">YELLOW (Staging)</option>
                <option value="GREEN">GREEN (Safe)</option>
            </select>
            <input type="number" id="labCapacity" placeholder="Capacity" min="1">
            <button class="button" onclick="createLab()">Create Lab</button>
            <div id="createLabError"></div>
        </div>

        <!-- Create Booking Section -->
        <div class="input-section">
            <h2>üìÖ Create New Booking</h2>
            <select id="bookingLabId">
                <option value="">Select Lab</option>
            </select>
            <input type="text" id="bookingTeam" placeholder="Team Name">
            <input type="datetime-local" id="bookingStart" placeholder="Start Time">
            <input type="datetime-local" id="bookingEnd" placeholder="End Time">
            <button class="button" onclick="createBooking()">Create Booking</button>
            <div id="createBookingError"></div>
        </div>

        <!-- Dashboard -->
        <div class="grid">
            <!-- Labs Card -->
            <div class="card">
                <h2>üè¢ Available Labs</h2>
                <div id="labsList" class="loading">Loading labs...</div>
            </div>

            <!-- Bookings Card -->
            <div class="card">
                <h2>üìã Current Bookings</h2>
                <div id="bookingsList" class="loading">Loading bookings...</div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px; font-size: 12px; color: #888;">
            <p>üîå Connected to: http://127.0.0.1:8000</p>
            <button class="button" onclick="location.href='http://127.0.0.1:8000/docs'">üìñ View API Docs</button>
            <button class="button" onclick="refreshData()">üîÑ Refresh Data</button>
        </div>
    </div>

    <!-- ADD THIS AFTER DASHBOARD GRID -->
<div style="text-align: center; margin: 30px 0;">
    <button onclick="clearAllData()" style="background: #e74c3c; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">
        üßπ Clear All Labs & Bookings
    </button>
</div>


    <script>
        const API = "http://127.0.0.1:8000";

        async function fetchLabs() {
            try {
                const res = await fetch(`${API}/labs/`);
                const labs = await res.json();
                const html = labs.length ? labs.map(lab => `
                    <div class="lab-item">
                        <div class="lab-name">${lab.name} 
                            <span class="lab-zone zone-${lab.zone.toLowerCase()}">${lab.zone}</span>
                        </div>
                        <div style="font-size: 12px; color: #aaa;">üìù ${lab.description}</div>
                        <div style="font-size: 12px; color: #aaa;">üë• Capacity: ${lab.capacity}</div>
                    </div>
                `).join('') : '<div style="color: #aaa;">No labs created yet.</div>';
                document.getElementById('labsList').innerHTML = html;

                // Update booking lab dropdown
                const options = labs.map(lab => `<option value="${String(lab.id)}">${lab.name}</option>`).join('');

                document.getElementById('bookingLabId').innerHTML = '<option value="">Select Lab</option>' + options;
            } catch (e) {
                document.getElementById('labsList').innerHTML = `<div class="error">Error: ${e.message}</div>`;
            }
        }

        async function fetchBookings() {
            try {
                const res = await fetch(`${API}/bookings/`);
                const bookings = await res.json();
                const html = bookings.length ? bookings.map(b => `
                    <div class="booking-item">
                        <div class="booking-team">${b.user_id || b.team || 'Team Alpha'} 
                            <span class="status status-${b.status.toLowerCase()}">${b.status}</span>
                        </div>
                        <div class="booking-time">üìÖ ${new Date(b.start_time).toLocaleString()} ‚Üí ${new Date(b.end_time).toLocaleString()}</div>
                        <div style="font-size: 12px; color: #aaa;">Lab ID: ${b.lab_id}</div>
                    </div>
                `).join('') : '<div style="color: #aaa;">No bookings yet.</div>';
                document.getElementById('bookingsList').innerHTML = html;
            } catch (e) {
                document.getElementById('bookingsList').innerHTML = `<div class="error">Error: ${e.message}</div>`;
            }
        }

        async function createLab() {
            const data = {
                name: document.getElementById('labName').value,
                description: document.getElementById('labDesc').value,
                zone: document.getElementById('labZone').value,
                capacity: parseInt(document.getElementById('labCapacity').value)
            };

            if (!data.name || !data.zone || !data.capacity) {
                document.getElementById('createLabError').innerHTML = '<div class="error">‚ö†Ô∏è All fields required</div>';
                return;
            }

            try {
                const res = await fetch(`${API}/labs/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (res.ok) {
                    document.getElementById('createLabError').innerHTML = '<div style="color: #2ecc71;">‚úì Lab created!</div>';
                    document.getElementById('labName').value = '';
                    document.getElementById('labDesc').value = '';
                    document.getElementById('labZone').value = '';
                    document.getElementById('labCapacity').value = '';
                    fetchLabs();
                } else {
                    const err = await res.json();
                    document.getElementById('createLabError').innerHTML = `<div class="error">‚ùå ${err.detail || 'Error'}</div>`;
                }
            } catch (e) {
                document.getElementById('createLabError').innerHTML = `<div class="error">‚ùå ${e.message}</div>`;
            }
        }

async function createBooking() {
    const data = {
        user_id: document.getElementById('bookingTeam').value,
        lab_id: document.getElementById('bookingLabId').value,
        start_time: document.getElementById('bookingStart').value,
        end_time: document.getElementById('bookingEnd').value
    };

    try {
        const res = await fetch(`${API}/bookings/`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });
        
        document.getElementById('createBookingError').innerHTML = '<div style="color: #2ecc71;">‚úÖ Booking created!</div>';
        document.getElementById('bookingTeam').value = '';
        document.getElementById('bookingStart').value = '';
        document.getElementById('bookingEnd').value = '';
        fetchBookings();
        
    } catch (e) {
        document.getElementById('createBookingError').innerHTML = '<div class="error">‚ùå Network error</div>';
    }
}

async function clearAllData() {
    if (!confirm('üßπ Clear ALL labs and bookings?')) return;
    
    try {
        // Clear bookings
        await fetch(`${API}/bookings/`, { method: 'DELETE' });
        // Clear labs  
        await fetch(`${API}/labs/`, { method: 'DELETE' });
        
        fetchLabs();
        fetchBookings();
        alert('‚úÖ ALL DATA CLEARED! Fresh start!');
    } catch (e) {
        alert('‚ùå Clear failed - restart server');
    }
}

        function refreshData() {
            fetchLabs();
            fetchBookings();
        }

        // Load on page open
        refreshData();
        setInterval(refreshData, 5000); // Auto-refresh every 5 seconds
    </script>
</body>
</html>
